"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[217],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=s(n),d=i,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return n?r.createElement(h,a(a({ref:t},p),{},{components:n})):r.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c[u]="string"==typeof e?e:i,a[1]=c;for(var s=2;s<o;s++)a[s]=n[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9803:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return p}});var r=n(7462),i=n(3366),o=(n(7294),n(3905)),a=["components"],c={slug:"/installation",sidebar_position:2},l="Installation",s={unversionedId:"installation",id:"installation",title:"Installation",description:"Prerequisites",source:"@site/docs/installation.md",sourceDirName:".",slug:"/installation",permalink:"/unifi-cam-proxy/installation",editUrl:"https://github.com/technonene/unifi-cam-proxy/tree/main/docs/docs/installation.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{slug:"/installation",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"about",permalink:"/unifi-cam-proxy/"},next:{title:"RTSP",permalink:"/unifi-cam-proxy/configuration/rtsp"}},p=[{value:"Prerequisites",id:"prerequisites",children:[{value:"Certificate",id:"certificate",children:[],level:3},{value:"Adoption Token",id:"adoption-token",children:[],level:3}],level:2},{value:"Docker",id:"docker",children:[{value:"example using the default h.264 codec",id:"example-using-the-default-h264-codec",children:[],level:3},{value:"example using the h.265/HEVC codec",id:"example-using-the-h265hevc-codec",children:[],level:3},{value:"Multiple cameras",id:"multiple-cameras",children:[],level:3},{value:"example using the default h.264 codec",id:"example-using-the-default-h264-codec-1",children:[],level:3},{value:"example using the h.265/HEVC codec",id:"example-using-the-h265hevc-codec-1",children:[],level:3}],level:2},{value:"Bare Metal",id:"bare-metal",children:[{value:"Ubuntu/Debian",id:"ubuntudebian",children:[],level:3}],level:2}],u={toc:p},m="wrapper";function d(e){var t=e.components,n=(0,i.Z)(e,a);return(0,o.kt)(m,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"installation"},"Installation"),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("h3",{id:"certificate"},"Certificate"),(0,o.kt)("p",null,"Generate a certificate by performing one of the following:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If you have a UniFi camera:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"scp ubnt@<your-unifi-cam>:/var/etc/persistent/server.pem client.pem\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create your own client certificate via:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'openssl ecparam -out /tmp/private.key -name prime256v1 -genkey -noout\nopenssl req -new -sha256 -key /tmp/private.key -out /tmp/server.csr -subj "/C=TW/L=Taipei/O=Ubiquiti Networks Inc./OU=devint/CN=camera.ubnt.dev/emailAddress=support@ubnt.com"\nopenssl x509 -req -sha256 -days 36500 -in /tmp/server.csr -signkey /tmp/private.key -out /tmp/public.key\ncat /tmp/private.key /tmp/public.key > client.pem\nrm -f /tmp/private.key /tmp/public.key /tmp/server.csr\n')))),(0,o.kt)("h3",{id:"adoption-token"},"Adoption Token"),(0,o.kt)("p",null,"In order to add a camera to Protect, you must first generate an adoption token.\nThe token is only valid for 60 minutes.\nYou will need to re-generate a new one if it expires during your initial setup."),(0,o.kt)("p",null,"Open https://{NVR IP}/proxy/protect/api/cameras/manage-payload and copy the token field."),(0,o.kt)("h2",{id:"docker"},"Docker"),(0,o.kt)("p",null,"Using Docker is the recommended installation method.\nThe sample docker-compose file below is the recommended deployment for most users.\nNote, the generated certificate must be in the same directory as the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," file."),(0,o.kt)("h3",{id:"example-using-the-default-h264-codec"},"example using the default h.264 codec"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.9"\nservices:\n  unifi-cam-proxy:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: unifi-cam-proxy --host {NVR IP} --cert /client.pem --token {Adoption token} rtsp -s rtsp://192.168.201.15:8554/cam\'\n')),(0,o.kt)("h3",{id:"example-using-the-h265hevc-codec"},"example using the h.265/HEVC codec"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.9"\nservices:\n  unifi-cam-proxy:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: unifi-cam-proxy --host {NVR IP} --cert /client.pem --token {Adoption token} --video-codec h265 rtsp -s rtsp://192.168.201.15:8554/cam\'\n')),(0,o.kt)("h3",{id:"multiple-cameras"},"Multiple cameras"),(0,o.kt)("p",null,"To use multiple cameras, start an instance of the proxy for each, with a unique MAC address argument.\nUsing docker-compose, your setup might look like the following:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Note: This conforms to MAC randomization rules, so should not cause issues with real devices.")),"\n",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"See here for more details: ",(0,o.kt)("a",{parentName:"em",href:"https://www.mist.com/get-to-know-mac-address-randomization-in-2020/"},"https://www.mist.com/get-to-know-mac-address-randomization-in-2020/")))),(0,o.kt)("h3",{id:"example-using-the-default-h264-codec-1"},"example using the default h.264 codec"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.5"\nservices:\n  proxy-1:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: >-\n        unifi-cam-proxy\n        --host {NVR IP}\n        --mac \'AA:BB:CC:00:11:22\'\n        --cert /client.pem\n        --token {Adoption token}\n        rtsp -s rtsp://192.168.201.15:8554/cam\n  proxy-2:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: >-\n        unifi-cam-proxy\n        --host {NVR IP}\n        --mac \'AA:BB:CC:33:44:55\'\n        --cert /client.pem\n        --token {Adoption token}\n        rtsp -s rtsp://192.168.201.15:8554/cam\n')),(0,o.kt)("h3",{id:"example-using-the-h265hevc-codec-1"},"example using the h.265/HEVC codec"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.5"\nservices:\n  proxy-1:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: >-\n        unifi-cam-proxy\n        --host {NVR IP}\n        --mac \'AA:BB:CC:00:11:22\'\n        --cert /client.pem\n        --token {Adoption token}\n        --video-codec h265\n        rtsp -s rtsp://192.168.201.15:8554/cam\n  proxy-2:\n    restart: unless-stopped\n    build: https://github.com/technonene/unifi-cam-proxy.git\n    volumes:\n      - "./client.pem:/client.pem"\n    command: >-\n        unifi-cam-proxy\n        --host {NVR IP}\n        --mac \'AA:BB:CC:33:44:55\'\n        --cert /client.pem\n        --token {Adoption token}\n        --video-codec h265\n        rtsp -s rtsp://192.168.201.15:8554/cam\n')),(0,o.kt)("h2",{id:"bare-metal"},"Bare Metal"),(0,o.kt)("p",null,"If you cannot use Docker, you can try to install the proxy on most Linux distros, but support is not guaranteed and may not be given by me.\nFind instructions for your distro below:"),(0,o.kt)("h3",{id:"ubuntudebian"},"Ubuntu/Debian"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"apt install ffmpeg netcat python3 python3-pip\npip3 install unifi-cam-proxy\nunifi-cam-proxy --host {NVR IP} --cert /client.pem --token {Adoption token} rtsp -s rtsp://192.168.201.15:8554/cam'\n")))}d.isMDXComponent=!0}}]);